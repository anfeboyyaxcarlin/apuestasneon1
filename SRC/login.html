<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Apuestas Neon</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary-color: #8a2be2;
      --secondary-color: #00ffff;
      --accent-color: #ff00ff;
      --text-color: #e0e0e0;
      --light-bg: #121212;
      --dark-bg: #000000;
      --white: #ffffff;
      --success-color: #00ff00;
      --error-color: #ff0000;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Courier New', monospace;
    }
    
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      line-height: 1.6;
      color: var(--text-color);
      background-color: var(--light-bg);
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(138, 43, 226, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(0, 255, 255, 0.1) 0%, transparent 50%);
      position: relative;
      overflow: hidden;
    }
    
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0, 0, 0, 0.85);
      z-index: -2;
    }
    
    #particles-js {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: -1;
    }
    
    .card {
      background: rgba(30, 30, 40, 0.8);
      backdrop-filter: blur(10px);
      padding: 2.5rem;
      border-radius: 1rem;
      box-shadow: 0 0 20px rgba(138, 43, 226, 0.5);
      border: 1px solid var(--primary-color);
      width: 90%;
      max-width: 450px;
      text-align: center;
      z-index: 1;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 20px rgba(0, 255, 255, 0.4);
    }
    
    h2 {
      margin-bottom: 1.5rem;
      color: var(--secondary-color);
      font-size: 2em;
      text-shadow: 0 0 10px var(--secondary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .input-group {
      margin-bottom: 1.2rem;
      position: relative;
    }
    
    input {
      width: 100%;
      padding: 1rem;
      border: 1px solid var(--primary-color);
      border-radius: 0.5rem;
      background: rgba(0, 0, 0, 0.4);
      color: white;
      outline: none;
      font-size: 1rem;
      box-shadow: 0 0 5px var(--primary-color);
      transition: all 0.3s ease;
    }
    
    input:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 10px var(--accent-color);
    }
    
    input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }
    
    .btn-group {
      display: flex;
      gap: 15px;
      margin-top: 1.5rem;
    }
    
    button {
      flex: 1;
      padding: 1rem;
      border: none;
      border-radius: 0.5rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1rem;
      box-shadow: 0 0 10px var(--primary-color);
    }
    
    .btn-login {
      background: var(--primary-color);
      color: white;
    }
    
    .btn-login:hover {
      background: #6a1cb9;
      box-shadow: 0 0 15px var(--primary-color);
      transform: translateY(-2px);
    }
    
    .btn-register {
      background: transparent;
      color: var(--secondary-color);
      border: 1px solid var(--secondary-color);
    }
    
    .btn-register:hover {
      background: rgba(0, 255, 255, 0.1);
      box-shadow: 0 0 15px var(--secondary-color);
      transform: translateY(-2px);
    }
    
    .msg {
      margin-top: 1.2rem;
      padding: 0.8rem;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      text-align: center;
    }
    
    .success {
      background: rgba(0, 255, 0, 0.2);
      border-left: 4px solid var(--success-color);
      color: var(--success-color);
      box-shadow: 0 0 10px var(--success-color);
    }
    
    .error {
      background: rgba(255, 0, 0, 0.2);
      border-left: 4px solid var(--error-color);
      color: var(--error-color);
      box-shadow: 0 0 10px var(--error-color);
    }
    
    .form-toggle {
      margin-top: 1.5rem;
      color: var(--text-color);
      font-size: 0.9rem;
    }
    
    .form-toggle a {
      color: var(--secondary-color);
      text-decoration: none;
      cursor: pointer;
      font-weight: bold;
      text-shadow: 0 0 5px var(--secondary-color);
    }
    
    .form-toggle a:hover {
      text-decoration: underline;
    }
    
    .neon-text {
      animation: flicker 1.5s infinite alternate;
    }
    
    @keyframes flicker {
      0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
        text-shadow:
          0 0 5px var(--secondary-color),
          0 0 10px var(--secondary-color),
          0 0 20px var(--secondary-color),
          0 0 40px var(--primary-color),
          0 0 80px var(--primary-color);
      }
      20%, 24%, 55% {
        text-shadow: none;
      }
    }
    
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div id="particles-js"></div>
  
  <div class="card">
    <!-- Formulario de Login -->
    <div id="login-form">
      <h2 class="neon-text"><i class="fas fa-futbol"></i> Iniciar Sesión</h2>
      <div class="input-group">
        <input id="email" type="email" placeholder="Correo electrónico">
      </div>
      <div class="input-group">
        <input id="password" type="password" placeholder="Contraseña">
      </div>
      <div class="btn-group">
        <button class="btn-login" onclick="login()">Entrar</button>
      </div>
      <div class="form-toggle">
        ¿No tienes cuenta? <a onclick="toggleForm('register')">Regístrate aquí</a>
      </div>
    </div>
    
    <!-- Formulario de Registro -->
    <div id="register-form" class="hidden">
      <h2 class="neon-text"><i class="fas fa-user-plus"></i> Crear Cuenta</h2>
      <div class="input-group">
        <input id="reg-email" type="email" placeholder="Correo electrónico">
      </div>
      <div class="input-group">
        <input id="reg-password" type="password" placeholder="Contraseña">
      </div>
      <div class="input-group">
        <input id="reg-username" type="text" placeholder="Nombre de usuario">
      </div>
      <div class="btn-group">
        <button class="btn-register" onclick="register()">Registrarse</button>
      </div>
      <div class="form-toggle">
        ¿Ya tienes cuenta? <a onclick="toggleForm('login')">Inicia sesión aquí</a>
      </div>
    </div>
    
    <div id="msg" class="msg"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <script>
    // Configuración de partículas
    document.addEventListener('DOMContentLoaded', function() {
      particlesJS("particles-js", {
        "particles": {
          "number": {
            "value": 80,
            "density": {
              "enable": true,
              "value_area": 800
            }
          },
          "color": {
            "value": ["#8a2be2", "#00ffff", "#ff00ff"]
          },
          "shape": {
            "type": "circle",
            "stroke": {
              "width": 0,
              "color": "#000000"
            }
          },
          "opacity": {
            "value": 0.5,
            "random": false
          },
          "size": {
            "value": 3,
            "random": true
          },
          "line_linked": {
            "enable": true,
            "distance": 150,
            "color": "#8a2be2",
            "opacity": 0.4,
            "width": 1
          },
          "move": {
            "enable": true,
            "speed": 3,
            "direction": "none",
            "random": false,
            "straight": false,
            "out_mode": "out",
            "bounce": false
          }
        },
        "interactivity": {
          "detect_on": "canvas",
          "events": {
            "onhover": {
              "enable": true,
              "mode": "grab"
            },
            "onclick": {
              "enable": true,
              "mode": "push"
            },
            "resize": true
          },
          "modes": {
            "grab": {
              "distance": 140,
              "line_linked": {
                "opacity": 1
              }
            },
            "push": {
              "particles_nb": 4
            }
          }
        },
        "retina_detect": true
      });
    });

    // Configuración de Supabase
    const SUPABASE_URL = "https://kyqiscbbnujogmzemkwv.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5cWlzY2JibnVqb2dtemVta3d2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxMTcyNzcsImV4cCI6MjA3MjY5MzI3N30.fY5PcI9AXiOUpSaJJNntC7nHXalCOUeVP0LifG_ywpk";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Alternar entre formularios de login y registro
    function toggleForm(formType) {
      if (formType === 'register') {
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('register-form').classList.remove('hidden');
      } else {
        document.getElementById('register-form').classList.add('hidden');
        document.getElementById('login-form').classList.remove('hidden');
      }
      // Limpiar mensajes al cambiar de formulario
      showMsg('', false);
    }

    function showMsg(text, error = false) {
      const msg = document.getElementById("msg");
      msg.textContent = text;
      msg.className = error ? "msg error" : "msg success";
    }

    async function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      if (!email || !password) {
        showMsg("Por favor completa todos los campos", true);
        return;
      }

      const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });
      if (error) {
        showMsg("❌ " + error.message, true);
      } else {
        showMsg("✅ Login exitoso, redirigiendo...");
        setTimeout(() => {
          window.location.href = "index.html";
        }, 1000);
      }
    }

    async function register() {
      const email = document.getElementById("reg-email").value;
      const password = document.getElementById("reg-password").value;
      const username = document.getElementById("reg-username").value;

      if (!email || !password || !username) {
        showMsg("Por favor completa todos los campos", true);
        return;
      }

      const { data, error } = await supabaseClient.auth.signUp({ email, password });
      if (error) {
        showMsg("❌ " + error.message, true);
        return;
      }

      const user = data.user;
      if (user) {
        await supabaseClient.from("profiles").insert([{
          id: user.id,
          username: username,
          saldo: 800000,
          betHistory: [],
          globalStats: {}
        }]);
      }

      showMsg("✅ Registro exitoso. Ahora puedes iniciar sesión");
      // Cambiar al formulario de login después de registrarse
      setTimeout(() => {
        toggleForm('login');
      }, 2000);
    }
  </script>
</body>
</html>